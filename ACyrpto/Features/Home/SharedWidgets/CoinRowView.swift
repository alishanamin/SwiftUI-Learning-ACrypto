//
//  CoinRowView.swift
//  ACyrpto
//
//  Created by ALI SHAN Muhammad Amin on 28/08/2025.
//

import SwiftUI

struct CoinRowView: View {
    let coin: CoinModel
    let showHoldings : Bool
    
    var body: some View {
        HStack (alignment: .center,spacing: 0){
            Text("\(coin.marketCapRank ?? 2)")
                .frame(minWidth: 30)
                .font(.callout)
                .padding(.trailing,5)
            
            AsyncImage(url: URL(string: coin.image)) { image in
                image.resizable()
            } placeholder: {
                ProgressView()
            }
            .frame(width: 35, height: 35)
            .clipShape(Circle())
            Text("\(coin.symbol.uppercased())")
                .frame(minWidth: 20)
                .font(.callout)
                .padding(.leading,6)
                .fontWeight(.bold)
            Spacer()
            if showHoldings{
                VStack (alignment: .trailing){
                    Text(
                        coin.currentHoldingsValue.format(using: .currency(code: "$"))
                    ).fontWeight(.bold)
                    Text(
                        coin.currentHoldings?.toString(decimals: 1) ?? "N/A"
                    )
                }
            }
            VStack (alignment: .trailing){
                Text(coin.currentPrice.toCurrencyStringFormat(code: "$")).fontWeight(.bold)
                Text(
                    coin.priceChangePercentage24hInCurrency?.asPercentString ?? "N/A"
                        
                ).foregroundStyle(.red)

                
            }.frame(minWidth: UIScreen.main.bounds.width/3)
        }
    }
}

#Preview("Light Mode") {
    CoinRowView(coin: CoinModel.mock, showHoldings: false)
        .preferredColorScheme(.light)
}

#Preview("Dark Mode") {
    CoinRowView(coin: CoinModel.mock, showHoldings: true)
        .preferredColorScheme(.dark)
}

// MARK: - Mock Coin for Preview
extension CoinModel {
    static let mock = CoinModel(
        id: "bitcoin",
        symbol: "btc",
        name: "Bitcoin",
        image: "https://assets.coingecko.com/coins/images/1/large/bitcoin.png",
        currentPrice: 1,
        marketCap: 1200000000000,
        marketCapRank: 1,
        fullyDilutedValuation: 1300000000000,
        totalVolume: 35000000000,
        high24h: 65000,
        low24h: 63000,
        priceChange24h: -500.23,
        priceChangePercentage24h: -0.78,
        marketCapChange24h: -10000000000,
        marketCapChangePercentage24h: -0.82,
        circulatingSupply: 19000000,
        totalSupply: 21000000,
        maxSupply: 21000000,
        ath: 69000,
        athChangePercentage: -7.89,
        athDate: "2013-07-06T00:00:00.000Z",
        // Example ATH date
        atl: 67.81,
        atlChangePercentage: 94765.12,
        atlDate: "2013-07-06T00:00:00.000Z",
        // Example ATL date
        roi: nil,
        lastUpdated: "2013-07-06T00:00:00.000Z",
        sparklineIn7D: SparklineIn7D(price: [111656.036215463, 111904.523790273, 112138.432557628, 112112.39935306, 112175.038745572, 112103.892222981, 112070.828210389, 113208.459266537, 114191.21156504, 113872.944174969, 113762.01286787, 114112.044667754, 114079.563386258, 114267.658154992, 114335.555815555, 114228.446075173, 114199.643612917, 114309.150411194, 114591.640751685, 114354.801025079, 114470.31365251, 114387.963528803, 114125.990664359, 113900.515148101, 114005.754729729, 113743.332637396, 113486.805477133, 112890.221009836, 113034.88754235, 113090.666325633, 113153.918952836, 113286.250464186, 113560.197938348, 113103.903795801, 112843.613033662, 113343.475428966, 113644.47187343, 114491.910339266, 114618.579149481, 114360.382378314, 113941.293714058, 114024.227835501, 114117.907476507, 114513.052509298, 114279.184710336, 114214.153626273, 114305.533414957, 114613.051897766, 114388.466178379, 114527.886675296, 116080.783668029, 116448.6876962, 116288.181648316, 116644.281371148, 116435.39338098, 116770.626623047, 117251.212653702, 117484.314213519, 117704.379055969, 116868.506492976, 117273.633763909, 117481.287601479, 117594.156808104, 117491.035065587, 117890.12765075, 118503.244517525, 118580.436672656, 118792.112744334, 118751.36338036, 118774.170302976, 118637.56780342, 118386.893395643, 118617.568658529, 118544.252459552, 118682.576623489, 118932.977019451, 118688.643262391, 118870.580177363, 119384.333509673, 119593.035789406, 118835.150461135, 119947.508364472, 119926.442473776, 119971.97108359, 120590.647863041, 120806.931076593, 120523.889807359, 120200.573722463, 120165.147023046, 120514.577855869, 120228.718173769, 120015.141017807, 120178.156405979, 120366.333288938, 120123.659227415, 119975.423586611, 119908.359931957, 119735.665578207, 120003.477661378, 120370.716223955, 120519.268420075, 120409.869854815, 120431.421250692, 120424.929564485, 120967.766350791, 122390.741750915, 122985.962350503, 122128.850131851, 122492.969303419, 122750.948556009, 122618.94461923, 122392.673222969, 122537.993849447, 122294.924417428, 122150.061266068, 121952.441672673, 121935.816875059, 122291.065914383, 122552.332316002, 122646.329352937, 122495.61278836, 122321.677351822, 122319.375888864, 122267.949689883, 122171.646887811, 122065.468235842, 122052.966008115, 122437.933970959, 122091.770086612, 121883.355771014, 121711.898584037, 121743.666193454, 121583.686969928, 121968.720521881, 121981.787912901, 122229.253627752, 122317.157203639, 122428.890633505, 122199.167412504, 122410.867131731, 124081.652183997, 123864.549774496, 125360.897417693, 125108.595321674, 125009.656246657, 124763.284946401, 124606.87490812, 123148.927224067, 123032.596826709, 123486.106831154, 123186.390584155, 123146.536538871, 123045.578111347, 122820.553813834, 123029.811033513, 123111.744503338, 123013.9043885, 122604.864931114, 122901.391226725, 122788.690821879, 123160.197816429, 123506.185200277, 123382.851588265, 124035.450552605, 124061.617924187, 123952.578118361, 123526.924061973]),
        priceChangePercentage24hInCurrency: -0.78,
        currentHoldings: 0
    )
}
